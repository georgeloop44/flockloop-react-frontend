FROM node:22-slim

# Install pnpm
RUN corepack enable && corepack prepare pnpm@9.15.0 --activate

WORKDIR /app

# Copy workspace config first for better caching
COPY package.json pnpm-workspace.yaml .npmrc turbo.json ./
COPY packages/typescript-config/package.json packages/typescript-config/
COPY packages/shared-types/package.json packages/shared-types/
COPY packages/auth-store/package.json packages/auth-store/
COPY packages/audio-state/package.json packages/audio-state/
COPY packages/api-client/package.json packages/api-client/
COPY packages/tailwind-config/package.json packages/tailwind-config/
COPY packages/eslint-config/package.json packages/eslint-config/
COPY apps/web/package.json apps/web/

# Install dependencies
RUN pnpm install

# Copy all source
COPY . .

EXPOSE 5173

CMD ["pnpm", "dev:web"]
